<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vokabeltrainer</title>
    <style>
      :root {
        --bg: #f6f7fb;
        --fg: #111827;
        --muted: #1764e9;
        --primary: #2563eb;
        --primary-contrast: #ffffff;
        --ok: #10b981;
        --bad: #ef4444;
        --card: #ffffff;
        --border: #8daded;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial;
        color: var(--fg);
        background: var(--bg);
      }
      header {
        position: sticky;
        top: 0;
        background: #fff;
        border-bottom: 1px solid var(--border);
        padding: 10px 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        z-index: 10;
      }
      header h1 {
        font-size: 18px;
        font-weight: 600;
        margin: 0 8px 0 0;
      }
      .spacer {
        flex: 1;
      }
      .btn {
        appearance: none;
        border: 0;
        background: var(--border);
        color: var(--fg);
        padding: 8px 12px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
      }
      .btn.primary {
        background: var(--primary);
        color: var(--primary-contrast);
      }
      .btn.success {
        background: var(--ok);
        color: #fff;
      }
      .btn.danger {
        background: var(--bad);
        color: #fff;
      }
      .btn.outline {
        background: transparent;
        border: 2px solid var(--border);
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .tabs .btn {
        background: var(--border);
      }
      .tabs .btn.active {
        background: var(--primary);
        color: #fff;
      }
      main {
        max-width: 840px;
        margin: 16px auto;
        padding: 0 12px 24px;
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 1px 0 rgba(0, 0, 0, 0.02);
      }
      .title {
        color: var(--muted);
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 8px;
      }
      .big {
        font-weight: 700;
        font-size: 28px;
        line-height: 1.3;
        margin: 8px 0;
      }
      .med {
        font-weight: 600;
        font-size: 22px;
        line-height: 1.35;
        margin: 6px 0;
        color: #8398b3;
      }
      .row {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        align-items: center;
      }
      .row.right {
        justify-content: flex-end;
      }
      .gap-12 {
        gap: 12px;
      }
      .mt-8 {
        margin-top: 8px;
      }
      .mt-12 {
        margin-top: 12px;
      }
      .mt-16 {
        margin-top: 16px;
      }
      .mt-20 {
        margin-top: 20px;
      }
      .mt-24 {
        margin-top: 24px;
      }
      .choices {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
        margin-top: 16px;
      }
      .choice {
        padding: 12px;
        border: 2px solid var(--border);
        border-radius: 10px;
        background: #fff;
        cursor: pointer;
        text-align: center;
        font-weight: 600;
      }
      .choice.correct {
        border-color: var(--ok);
        background: #ecfdf5;
      }
      .choice.wrong {
        border-color: var(--bad);
        background: #fef2f2;
      }
      .progress {
        font-weight: 600;
        color: var(--muted);
        font-size: 13px;
        margin-top: 8px;
      }
      .results {
        text-align: center;
      }
      input[type="text"] {
        width: 100%;
        padding: 12px 14px;
        border: 2px solid var(--primary);
        border-radius: 10px;
        font-size: 18px;
        font-weight: 600;
      }
      @media (prefers-color-scheme: dark) {
        body {
          background: #0b1220;
          color: #e5e7eb;
        }
        header {
          background: #0f172a;
          border-bottom-color: #1f2937;
        }
        .card {
          background: #0f172a;
          border-color: #1f2937;
        }
        .btn {
          background: #1f2937;
          color: #e5e7eb;
        }
        .btn.outline {
          border-color: #1f2937;
        }
        input[type="text"] {
          background: #0f172a;
          color: #e5e7eb;
          border-color: #334155;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Vokabeltrainer</h1>
      <div class="tabs row">
        <button id="tab-learn" class="btn">Lernen</button>
        <button id="tab-practice" class="btn">Üben</button>
        <button id="tab-test" class="btn">Test</button>
      </div>
      <div class="spacer"></div>
      <button id="btn-reshuffle" class="btn outline">⟲ Neu mischen</button>
    </header>
    <main>
      <section id="view-learn" class="view">
        <div class="card">
          <div class="title">Vokabel</div>
          <div id="learn-de" class="big"></div>
          <div id="learn-en" class="med"></div>
          <div class="row right mt-16">
            <button id="btn-learn-next" class="btn primary">Weiter</button>
          </div>
          <div id="learn-finished" class="results mt-16" style="display: none">
            <div class="med" style="margin-bottom: 10px">
              Lernrunde abgeschlossen!
            </div>
            <button id="btn-learn-restart" class="btn primary">
              Nochmal lernen
            </button>
          </div>
        </div>
      </section>

      <section id="view-practice" class="view" style="display: none">
        <div class="card">
          <div class="title" id="practice-dir"></div>
          <div id="practice-prompt" class="big"></div>
          <div id="practice-choices" class="choices"></div>
          <div
            id="practice-finished"
            class="results mt-16"
            style="display: none"
          >
            <div class="med" id="practice-score"></div>
            <button id="btn-practice-restart" class="btn primary mt-12">
              Nochmal starten
            </button>
          </div>
          <div class="progress" id="practice-progress"></div>
        </div>
      </section>

      <section id="view-test" class="view" style="display: none">
        <div class="card">
          <div class="title">Schreibe die englische Übersetzung (de → en)</div>
          <div id="test-prompt" class="big"></div>
          <input
            id="test-input"
            type="text"
            autocomplete="off"
            autocapitalize="off"
            spellcheck="false"
            class="mt-12"
          />
          <div class="row right mt-12 gap-12">
            <button id="btn-test-check" class="btn primary">Prüfen</button>
          </div>
          <div id="test-feedback" class="med mt-12"></div>
          <div id="test-finished" class="results mt-16" style="display: none">
            <div class="med" id="test-score"></div>
            <button id="btn-test-restart" class="btn primary mt-12">
              Nochmal starten
            </button>
          </div>
          <div class="progress" id="test-progress"></div>
        </div>
      </section>
    </main>

    <script>
      // Daten
      const VOCAB = [
        { de: "Hallo", en: "Hello" },
        { de: "Ich heiße …", en: "My name is …" },
        { de: "sein", en: "to be" },
        { de: "Wie heißt du?; Wie heißen Sie?", en: "What's your name?" },
        { de: "Hi.; Hallo.", en: "Hi" },
        { de: "Ich bin …", en: "I'm …" },
        {
          de: "Woher kommst du/kommt ihr/kommen Sie?",
          en: "Where are you from?",
        },
        { de: "Ich bin aus …", en: "I'm from …" },
        { de: "aber", en: "but" },
        { de: "Ich wohne in …", en: "I live in …" },
        { de: "wohnen; leben", en: "to live" },
        { de: "Wie alt bist du?; Wie alt sind Sie?", en: "How old are you?" },
        { de: "Ich auch.", en: "Me too." },
        { de: "Bis dann!; Bis …", en: "See you!" },
        { de: "sehen", en: "to see" },
        { de: "Tschüss!", en: "Bye!" },
        { de: "neu", en: "new" },
        { de: "Freund/-in", en: "friend" },
        { de: "willkommen (in)", en: "welcome (to)" },
        { de: "Was kannst du/könnt ihr hören?", en: "What can you hear?" },
        { de: "hören", en: "to hear" },
        { de: "der; die; das", en: "the" },
        { de: "Ich kann …", en: "I can …" },
        { de: "ein/-e", en: "a" },
        { de: "Boot", en: "boat" },
        { de: "Blume", en: "flower" },
        { de: "Mädchen", en: "girl" },
        { de: "auf; an; am; in; im", en: "on" },
        { de: "Inlineskates; Rollschuhe; Schlittschuhe", en: "skates" },
        { de: "Junge", en: "boy" },
        { de: "Mutter", en: "mother" },
        { de: "Vater", en: "father" },
        { de: "Hund", en: "dog" },
        { de: "Katze", en: "cat" },
        { de: "Vogel", en: "bird" },
        { de: "Schmetterling", en: "butterfly" },
        { de: "Biene", en: "bee" },
        { de: "Baum", en: "tree" },
        { de: "Gras", en: "grass" },
        { de: "Fahrrad", en: "bike" },
        { de: "ein Picknick machen", en: "to have a picnic" },
        { de: "lesen", en: "to read" },
        { de: "Buch", en: "book" },
        { de: "spielen", en: "to play" },
        { de: "fahren; reiten", en: "to ride" },
        { de: "reden mit", en: "to talk to" },
      ];

      // Utils
      function shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }
      function splitAlts(str) {
        return (str || "")
          .split(";")
          .map((s) => s.trim())
          .filter(Boolean);
      }

      // Tabs/Mode
      const tabLearn = document.getElementById("tab-learn");
      const tabPractice = document.getElementById("tab-practice");
      const tabTest = document.getElementById("tab-test");
      const btnReshuffle = document.getElementById("btn-reshuffle");
      const views = {
        learn: document.getElementById("view-learn"),
        practice: document.getElementById("view-practice"),
        test: document.getElementById("view-test"),
      };
      let mode = "learn";
      function setMode(m) {
        mode = m;
        for (const k of Object.keys(views)) {
          views[k].style.display = k === m ? "block" : "none";
        }
        tabLearn.classList.toggle("active", m === "learn");
        tabPractice.classList.toggle("active", m === "practice");
        tabTest.classList.toggle("active", m === "test");
      }

      tabLearn.addEventListener("click", () => {
        setMode("learn");
        startLearn();
      });
      tabPractice.addEventListener("click", () => {
        setMode("practice");
        startPractice();
      });
      tabTest.addEventListener("click", () => {
        setMode("test");
        startTest();
      });
      btnReshuffle.addEventListener("click", () => {
        if (mode === "learn") startLearn();
        else if (mode === "practice") startPractice();
        else startTest();
      });

      // Learn
      const elLearnDE = document.getElementById("learn-de");
      const elLearnEN = document.getElementById("learn-en");
      const elLearnNext = document.getElementById("btn-learn-next");
      const elLearnFinished = document.getElementById("learn-finished");
      const elLearnRestart = document.getElementById("btn-learn-restart");
      let learnOrder = [],
        learnIndex = 0;
      function startLearn() {
        learnOrder = shuffle([...Array(VOCAB.length).keys()]);
        learnIndex = 0;
        renderLearn();
      }
      function renderLearn() {
        if (learnIndex >= learnOrder.length) {
          elLearnDE.textContent = "";
          elLearnEN.textContent = "";
          elLearnNext.style.display = "none";
          elLearnFinished.style.display = "block";
          return;
        }
        const v = VOCAB[learnOrder[learnIndex]];
        elLearnDE.textContent = v.de;
        elLearnEN.textContent = v.en;
        elLearnFinished.style.display = "none";
        elLearnNext.style.display = "inline-block";
      }
      elLearnNext.addEventListener("click", () => {
        learnIndex++;
        renderLearn();
      });
      elLearnRestart.addEventListener("click", () => {
        startLearn();
      });

      // Practice (Multiple Choice)
      const elPracticeDir = document.getElementById("practice-dir");
      const elPracticePrompt = document.getElementById("practice-prompt");
      const elPracticeChoices = document.getElementById("practice-choices");
      const elPracticeFinished = document.getElementById("practice-finished");
      const elPracticeScore = document.getElementById("practice-score");
      const elPracticeRestart = document.getElementById("btn-practice-restart");
      const elPracticeProgress = document.getElementById("practice-progress");
      let pracQueue = [],
        pracCurrent = null,
        pracChoices = [],
        pracCorrect = -1,
        pracStats = { asked: 0, correct: 0, wrong: 0, finished: false };
      function startPractice() {
        pracStats = { asked: 0, correct: 0, wrong: 0, finished: false };
        const idxs = [...Array(VOCAB.length).keys()];
        shuffle(idxs);
        pracQueue = idxs.map((i) => ({
          i,
          dir: Math.random() < 0.5 ? "de2en" : "en2de",
        }));
        nextPractice();
      }
      function nextPractice() {
        if (pracQueue.length === 0) {
          pracStats.finished = true;
          renderPractice();
          return;
        }
        pracCurrent = pracQueue.shift();
        const v = VOCAB[pracCurrent.i];
        const dir = pracCurrent.dir;
        elPracticeDir.textContent =
          dir === "de2en" ? "Übersetze (de → en)" : "Übersetze (en → de)";
        const correct = dir === "de2en" ? v.en : v.de;
        const pool =
          dir === "de2en" ? VOCAB.map((x) => x.en) : VOCAB.map((x) => x.de);
        const options = new Set([correct]);
        while (options.size < 3 && pool.length > 1) {
          const cand = pool[Math.floor(Math.random() * pool.length)];
          if (cand !== correct) options.add(cand);
        }
        pracChoices = shuffle(Array.from(options));
        pracCorrect = pracChoices.indexOf(correct);
        pracStats.asked++;
        renderPractice();
      }
      function answerPractice(idx) {
        if (pracStats.finished) return;
        const ok = idx === pracCorrect;
        if (ok) pracStats.correct++;
        else pracStats.wrong++;
        setTimeout(() => nextPractice(), 500);
        renderPractice(idx);
      }
      function renderPractice(chosenIdx) {
        elPracticeFinished.style.display = pracStats.finished
          ? "block"
          : "none";
        if (pracStats.finished) {
          const acc =
            pracStats.correct + pracStats.wrong > 0
              ? Math.round(
                  (100 * pracStats.correct) /
                    (pracStats.correct + pracStats.wrong)
                )
              : 0;
          elPracticeScore.textContent = `Üben fertig! Richtig: ${pracStats.correct} | Falsch: ${pracStats.wrong} | Trefferquote: ${acc}%`;
          elPracticePrompt.textContent = "";
          elPracticeChoices.innerHTML = "";
          elPracticeProgress.textContent = "";
          return;
        }
        const v = VOCAB[pracCurrent.i];
        elPracticePrompt.textContent =
          pracCurrent.dir === "de2en" ? v.de : v.en;
        elPracticeChoices.innerHTML = "";
        pracChoices.forEach((text, i) => {
          const b = document.createElement("button");
          b.type = "button";
          b.className = "choice";
          b.textContent = text;
          b.addEventListener("click", () => answerPractice(i));
          if (typeof chosenIdx === "number") {
            if (i === pracCorrect) b.classList.add("correct");
            if (i === chosenIdx && i !== pracCorrect) b.classList.add("wrong");
            b.disabled = true;
          }
          elPracticeChoices.appendChild(b);
        });
        elPracticeProgress.textContent = `Richtig: ${pracStats.correct}  |  Falsch: ${pracStats.wrong}`;
      }
      elPracticeRestart.addEventListener("click", () => startPractice());

      // Test (Freitext)
      const elTestPrompt = document.getElementById("test-prompt");
      const elTestInput = document.getElementById("test-input");
      const elTestCheck = document.getElementById("btn-test-check");
      const elTestFeedback = document.getElementById("test-feedback");
      const elTestFinished = document.getElementById("test-finished");
      const elTestScore = document.getElementById("test-score");
      const elTestRestart = document.getElementById("btn-test-restart");
      const elTestProgress = document.getElementById("test-progress");
      let testQueue = [],
        testCurrent = null,
        testStats = { asked: 0, correct: 0, wrong: 0, finished: false };
      let testAdvanceTimeout = null;
      function startTest() {
        const idxs = [...Array(VOCAB.length).keys()];
        shuffle(idxs);
        testQueue = idxs.map((i) => ({ i }));
        testStats = { asked: 0, correct: 0, wrong: 0, finished: false };
        elTestInput.value = "";
        elTestInput.focus();
        nextTest();
      }
      function nextTest() {
        elTestFeedback.textContent = "";
        elTestFeedback.style.color = "";
        elTestInput.value = "";
        if (testQueue.length === 0) {
          testStats.finished = true;
          renderTest();
          return;
        }
        testCurrent = testQueue.shift();
        testStats.asked++;
        renderTest();
      }
      // Case-sensitive: nur Leerzeichen normalisieren, keine Kleinschreibung
      function normalizeAnswer(s) {
        return s.replace(/\s+/g, " ").trim();
      }
      let testFeedbackVisible = false;
      function checkTest() {
        if (!testCurrent || testStats.finished) return;
        if (testFeedbackVisible) return; // Feedback schon sichtbar, nicht erneut prüfen
        const v = VOCAB[testCurrent.i];
        const expectedAlts = splitAlts(v.en).map(normalizeAnswer);
        const given = normalizeAnswer(elTestInput.value || "");
        const ok = expectedAlts.includes(given);
        if (ok) testStats.correct++;
        else testStats.wrong++;
        elTestFeedback.textContent = ok
          ? "Richtig!"
          : `Falsch – korrekt: ${expectedAlts[0] || v.en}`;
        elTestFeedback.style.color = ok ? "var(--ok)" : "var(--bad)";
        testFeedbackVisible = true;
        const delay = ok ? 800 : 3000;
        if (testAdvanceTimeout) {
          clearTimeout(testAdvanceTimeout);
          testAdvanceTimeout = null;
        }
        testAdvanceTimeout = setTimeout(() => {
          testAdvanceTimeout = null;
          skipAdvance();
        }, delay);
      }
      function skipAdvance() {
        if (testAdvanceTimeout) {
          clearTimeout(testAdvanceTimeout);
          testAdvanceTimeout = null;
        }
        if (testFeedbackVisible) {
          testFeedbackVisible = false;
          nextTest();
        }
      }
      function renderTest() {
        elTestFinished.style.display = testStats.finished ? "block" : "none";
        if (testStats.finished) {
          const acc =
            testStats.correct + testStats.wrong > 0
              ? Math.round(
                  (100 * testStats.correct) /
                    (testStats.correct + testStats.wrong)
                )
              : 0;
          elTestScore.textContent = `Test abgeschlossen! Richtig: ${testStats.correct} | Falsch: ${testStats.wrong} | Trefferquote: ${acc}%`;
          elTestPrompt.textContent = "";
          elTestProgress.textContent = "";
          return;
        }
        const v = VOCAB[testCurrent.i];
        elTestPrompt.textContent = v.de;
        elTestProgress.textContent = `Richtig: ${testStats.correct}  |  Falsch: ${testStats.wrong}`;
        elTestInput.focus();
        testFeedbackVisible = false;
      }
      elTestCheck.addEventListener("click", (e) => {
        // Beim ersten Klick Feedback zeigen und Click nicht hochbubblen
        if (!testFeedbackVisible) {
          checkTest();
          e.stopPropagation();
        } else {
          skipAdvance();
        }
      });
      elTestInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          if (!testFeedbackVisible) checkTest();
          else skipAdvance();
        }
      });
      // Klick in die Test-Ansicht nach Feedback: Wartezeit überspringen
      document.addEventListener("click", (e) => {
        const testView = document.getElementById("view-test");
        if (
          mode === "test" &&
          elTestFeedback.textContent &&
          testView.contains(e.target)
        ) {
          skipAdvance();
        }
      });
      elTestRestart.addEventListener("click", () => startTest());

      // Initial
      setMode("learn");
      startLearn();
    </script>
  </body>
</html>
